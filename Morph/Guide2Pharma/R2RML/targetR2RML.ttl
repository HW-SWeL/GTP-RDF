#########################
#Liam Bruce - 24/04/2017#
#Alasdair Gray          #
#########################

@base <http://rdf.guidetopharmacology.org/GRAC/> .
@prefix gtpo: <http://rdf.guidetopharmacology.org/ns/gtpo/>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix rr: <http://www.w3.org/ns/r2rml#> .

#################################
# Generate key target data - id #
# name, annotation status       #
#################################

<TriplesMap1>
    a rr:TriplesMap;

    rr:logicalTable [ rr:sqlQuery """
		SELECT
		distinct object.object_id AS id,
		object.name AS name,
		object.annotation_status,
		CASE
			WHEN object.annotation_status = '1' THEN 'AnnotatedExpertReviewed'
			WHEN object.annotation_status = '2' THEN 'AnnotatedExpertReviewed'
			WHEN object.annotation_status = '3' THEN 'AnnotatedAwaitingReview'
			WHEN object.annotation_status = '4' THEN 'UnderDevelopment'
			WHEN object.annotation_status = '5' THEN 'UnderDevelopment'
		END AS status
		FROM object;
		""";] ;

    rr:subjectMap [ rr:template "http://rdf.guidetopharmacology.org/GRAC/target{id}"];

	rr:predicateObjectMap
    [
      rr:predicate	rdf:type ;
      rr:objectMap	[ rr:constant gtpo:Target ];
    ];
	rr:predicateObjectMap
    [
      rr:predicate	rdfs:label ;
      rr:objectMap	[ rr:column "name" ];
    ];
    rr:predicateObjectMap
    [
      rr:predicate	gtpo:nomenclature ;
      rr:objectMap	[ rr:column "name" ];
    ];
	 rr:predicateObjectMap [
        rr:predicate gtpo:annotationStatus;
        rr:objectMap [ rr:template "http://rdf.guidetopharmacology.org/ns/gtpo/{status}" ];
	]
	.


####################################
# Generate target family relations #
####################################

	<TriplesMap2>
    a rr:TriplesMap;

    rr:logicalTable [ rr:sqlQuery """
		SELECT
		object.object_id AS id,
		family.family_id AS family
		FROM object, receptor2family, family
		WHERE family.family_id = receptor2family.family_id
		AND object.object_id = receptor2family.object_id;
		""";] ;

    rr:subjectMap [ rr:template "http://rdf.guidetopharmacology.org/GRAC/target{id}"];

	 rr:predicateObjectMap [
        rr:predicate gtpo:hasTargetFamily;
        rr:objectMap [ rr:template "http://rdf.guidetopharmacology.org/GRAC/targetFamily{family}" ];
	]
	.
#####################################################################
# Generates blank node for the cross reference data and taxonomy id #
# where they exist                                                  #
#####################################################################

	<TriplesMap3>
	a rr:TriplesMap;
	rr:logicalTable [ rr:sqlQuery """
		SELECT O.object_id AS id,
		database_id as DB,
		placeholder AS external_id,
		S.species_id AS species,
		ncbi_taxonomy_id AS ncbi
		FROM object O, database_link DL, species S
		WHERE O.object_id = DL.object_id
		AND S.species_id = DL.species_id
		AND database_id = 5;
		""";];
	rr:subjectMap [rr:template "http://rdf.guidetopharmacology.org/GRAC/target{id}";];
	rr:predicateObjectMap
	[
		rr:predicate gtpo:hasRef;
		rr:objectMap [
		rr:template "ref{id}_{species}";
		rr:termType rr:BlankNode;
		];
	]
	.

##########################################
# Generates reference data in blank node #
##########################################

	<TriplesMap4>
    a rr:TriplesMap;

    rr:logicalTable [ rr:sqlQuery """
		SELECT O.object_id AS id,
		database_id as DB,
		placeholder AS external_id,
		S.species_id AS species,
		ncbi_taxonomy_id AS ncbi,
		CASE
		WHEN database_id = 5 THEN 'http://identifiers.org/uniprot/'
		END AS namespace
		FROM object O, database_link DL, species S
		WHERE O.object_id = DL.object_id
		AND S.species_id = DL.species_id
		AND database_id = 5;
		""";] ;

    rr:subjectMap [ rr:template "ref{id}_{species}";
					rr:termType rr:BlankNode; ];

	 rr:predicateObjectMap [
        rr:predicate gtpo:xref;
        rr:objectMap [ rr:template "{namespace}{external_id}" ];
	];
	 rr:predicateObjectMap [
		rr:predicate gtpo:hasTaxonomy;
		rr:objectMap [ rr:template "http://purl.obolibrary.org/obo/NCBITaxon_{ncbi}"];
	]
	.

#####################################
# Generate target family data - id, #
# name and family class             #
#####################################


	<TriplesMap5>
    a rr:TriplesMap;

    rr:logicalTable [ rr:sqlQuery """
		SELECT distinct family_id AS id,
		name,
    CASE
    WHEN type = 'catalytic_receptor' THEN 'CatalyticReceptorTargetFamily'
    WHEN type = 'enzyme' THEN 'EnzymeTargetFamily'
    WHEN type = 'grouping' THEN 'GroupingTargetFamily'
    WHEN type = 'gpcr' THEN 'GProteinCoupledReceptorTargetFamily'
    WHEN type = 'lgic' THEN 'LigandGatedIonChannelTargetFamily'
    WHEN type = 'ligand' THEN 'LigandTargetFamily'
    WHEN type = 'nhr' THEN 'NuclearHormoneReceptorTargetFamily'
    WHEN type = 'other_ic' THEN 'OtherIonChannelTargetFamily'
    WHEN type = 'other_protein' THEN 'OtherProteinTargetFamily'
    WHEN type = 'transporter' THEN 'TransporterTargetFamily'
    WHEN type = 'vgic' THEN 'VoltageGatedIonChannelTargetFamily'
		END AS type
		FROM family;
		""";] ;

    rr:subjectMap [ rr:template "http://rdf.guidetopharmacology.org/GRAC/targetFamily{id}"; ];

	rr:predicateObjectMap
    [
      rr:predicate	rdf:type ;
      rr:objectMap	[ rr:template "http://rdf.guidetopharmacology.org/ns/gtpo/{type}" ];
    ];
	rr:predicateObjectMap
    [
      rr:predicate	rdfs:label;
      rr:objectMap	[ rr:column "name" ]
    ];
    rr:predicateObjectMap
    [
      rr:predicate	gtpo:targetFamilyName;
      rr:objectMap	[ rr:column "name" ]
    ];
	.
